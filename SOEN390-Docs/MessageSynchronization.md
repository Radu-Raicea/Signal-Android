# Message Synchronization

Before the message reactions feature implementation, each message was stored independantly on all participating devices. The message contents are encrypted, but the entry also contains meta information about the message itself (send time, sender, read status, etc.). However, the same message on two different devices did not have any explicit link between each other. This would make it impossible to react to specific messages since the subject of the reaction needs to be agreed upon.

An initial approach could be to have the sender send some extra metadata along with the message content which could act as a shared id for all devices receiving that message. However, that solution does not account for the messages which exist prior to the implementation of the feature or for senders that have not yet been updated and who will therefore not be sending that id along with the message. Our solution is to have the shared key be computed on each device independantly using information that is unique to that message. In more concrete terms, we pass the message sender's address and the message's send time through a hash function to generate the key. Since this key was created from the same inputs on both devices, it will always match. This technique also allows us to retroactively calculate the keys on the existing messages sitting in the database at the time of the update.
